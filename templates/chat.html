{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <title>JobBoard &mdash; Website Template by Colorlib</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    
    <link rel="stylesheet" href={% static "css/custom-bs.css" %}>
    <link rel="stylesheet" href={% static "css/jquery.fancybox.min.css" %}>
    <link rel="stylesheet" href={% static "css/bootstrap-select.min.css" %}>
    <link rel="stylesheet" href={% static "fonts/icomoon/style.css" %}>
    <link rel="stylesheet" href={% static "fonts/line-icons/style.css" %}>
    <link rel="stylesheet" href={% static "css/owl.carousel.min.css" %}>
    <link rel="stylesheet" href={% static "css/animate.min.css" %}>

    <!-- MAIN CSS -->
    <link rel="stylesheet" href={% static "css/style.css" %}>  
  </head>
  <body id="top">

  {% comment %} <div id="overlayer"></div>
  <div class="loader">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
     {% endcomment %}

<div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
      <div class="site-mobile-menu-header">
        <div class="site-mobile-menu-close mt-3">
          <span class="icon-close2 js-menu-toggle"></span>
        </div>
      </div>
      <div class="site-mobile-menu-body"></div>
    </div> <!-- .site-mobile-menu -->
    

    <!-- NAVBAR -->
   {% include "navbar.html" %}
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
      .containers { display: flex; width: 100vw; height: 100vh; background:rgb(110, 109, 109); }
      .recent { width: 280px; background:transparent; overflow-y: auto; padding: 10px; height: calc(100vh - 90px); margin-top: 90px; scrollbar-width: none; }
      .chatset { padding: 13px; background:rgb(216, 216, 216); border-bottom: 1px ; cursor: pointer;border-radius:10px; }
      .names { font-size: 18px; color: black; text-align: center; }
      .chats { flex: 1; display: flex; flex-direction: column; background:rgb(255, 255, 255); height: calc(100vh - 90px); margin-top: 90px; }
      .chat-container {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        color: white;
        display: flex;
        flex-direction: column;  /* Change from column-reverse to column */
        scrollbar-width: none;
    }
    
      .msg, .reply { max-width: 60%; padding: 10px; border-radius: 8px; margin: 5px 0; }
      .msg { background: #007bff; align-self: flex-end; text-align: right; border-top-right-radius: 0;box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1); }
      .reply { background: #e0e0e0; align-self: flex-start; text-align: left; border-top-left-radius: 0;color: #333;box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1); }
      .btm { padding: 10px; display: flex;  }
      .inpt { flex: 1; padding: 10px; border-radius: 12px; outline: none; border: none;background: #d4f8c6;border-radius: 25px;margin-right:5px; }
      .btn {  color: white; padding: 10px; border-radius: 8px; border: none; cursor: pointer;background: #000;transition: 0.3s; }
      #send_button:hover {
        background: #333;
    }
  </style>
  <style>
    .chats {
      margin: 0;
      margin-top: 90px;
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
  .chat-container{
    margin: 0;
      
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
  }
    .chatset,.recent{
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    </style>
    
</head>
<body>

  <div class="containers">
    <div class="recent">
      {% comment %} {% for session in session %} {% endcomment %}
      <div class="chatset"><div class="names">{{ session.company_name }} - {{ session.position_name }}
      </div></div>
        
      {% comment %} {% endfor %} {% endcomment %}
        {% comment %} <div class="chatset"><div class="names">Microsoft</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div>
        <div class="chatset"><div class="names">OpenAI</div></div> {% endcomment %}
    </div>
    <div class="chats">
        <div class="chat-container" id="chat-box"></div>
        
        <div class="btm">
            <input type="text" id="user-input" class="inpt" placeholder="Type a message...">
            <button class="btn" id='send_button' >Send</button>
        </div>
     
    </div>
</div>
<script>

  {% comment %} document.addEventListener("DOMContentLoaded", function () {
    document.addEventListener("DOMContentLoaded", function () {
      let sendButton = document.getElementById("send_button");
      let inputField = document.getElementById("user-input");
      let chatBox = document.getElementById("chat-box");
      let sessionId = "{{ session.id }}";  // Use first session if available
  
      if (!sendButton || !inputField || !chatBox) {
          console.error("Required elements not found!");
          return;
      }
  
      sendButton.addEventListener("click", sendMessage);
  
      inputField.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
              sendMessage(e);
          }
      });
  
      document.querySelector(".btm form").addEventListener("submit", sendMessage);
  
      function getCSRFToken() {
          return document.cookie.split("; ")
              .find(row => row.startsWith("csrftoken="))
              ?.split("=")[1];
      }
  
      function loadChatMessages() {
          fetch(`/get_messages/${sessionId}/`)
              .then(response => response.json())
              .then(data => {
                  chatBox.innerHTML = "";  // Clear chat box
                  data.messages.forEach(msg => {
                      let msgDiv = document.createElement("div");
                      msgDiv.className = msg.sender === "user" ? "msg" : "reply";
                      msgDiv.innerText = msg.message;
                      chatBox.appendChild(msgDiv);
                  });
                  chatBox.scrollTop = chatBox.scrollHeight;
              });
      }
  
      function sendMessage(event) {
          event.preventDefault();
  
          let message = inputField.value.trim();
          if (message === "") return;
  
          fetch("/send_message/", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json",
                  "X-CSRFToken": getCSRFToken()
              },
              body: JSON.stringify({
                  session_id: sessionId,
                  message: message
              })
          })
          .then(response => response.json())
          .then(data => {
              let userMsg = document.createElement("div");
              userMsg.className = "msg";
              userMsg.innerText = message;
              chatBox.appendChild(userMsg);
  
              setTimeout(() => {
                  let botReply = document.createElement("div");
                  botReply.className = "reply";
                  botReply.innerText = data.bot_reply;
                  chatBox.appendChild(botReply);
                  chatBox.scrollTop = chatBox.scrollHeight;
              }, 1000);
  
              inputField.value = "";
          });
      }
  
      loadChatMessages();
  });
  
}); {% endcomment %}


{% comment %} ======================================================================================================================== {% endcomment %}


 //document.addEventListener("DOMContentLoaded", function () {
  //document.getElementById("send_button").addEventListener("click", sendMessage);
  document.addEventListener("DOMContentLoaded", function() {
    let sendButton = document.getElementById("send_button");
    if (sendButton) {
        sendButton.addEventListener("click", sendMessage);
    } else {
        console.error("Send button not found!");
    }
    let inputField = document.getElementById("user-input");
    inputField.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
    sendMessage(e);
    }
    });

});


      let chatBox = document.getElementById("chat-box");
      let sessionId = "{{ session.id }}";  // Use first session if available
  
      function getCSRFToken() {
        return document.cookie.split("; ")
            .find(row => row.startsWith("csrftoken="))
            ?.split("=")[1];
    }
    
  
      function loadChatMessages() {
          fetch(`/get_messages/${sessionId}/`)
              .then(response => response.json())
              .then(data => {
                  chatBox.innerHTML = "";  // Clear chat box before loading messages
                  data.messages.forEach(msg => {
                      let msgDiv = document.createElement("div");
                      msgDiv.className = msg.sender === "user" ? "msg" : "reply";
                      msgDiv.innerText = msg.message;
                      chatBox.appendChild(msgDiv);
                  });
                  chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to latest message
              });
      }
  
      function sendMessage(event) {
          event.preventDefault(); // Prevent form submission
  
          let inputField = document.getElementById("user-input");
          let message = inputField.value.trim();
          if (message === "") return;
  
          let chatData = {
              session_id: sessionId,
              message: message
          };
  
          fetch("/send_message/", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json",
                  "X-CSRFToken": getCSRFToken()
              },
              body: JSON.stringify(chatData)
          })
          .then(response => response.json())
          .then(data => {
              let userMsg = document.createElement("div");
              userMsg.className = "msg";
              userMsg.innerText = message;
              chatBox.appendChild(userMsg);
  
              setTimeout(() => {
                  let botReply = document.createElement("div");
                  botReply.className = "reply";
                  botReply.innerText = data.bot_reply;
                  chatBox.appendChild(botReply);
                  chatBox.scrollTop = chatBox.scrollHeight;
              }, 1000);
          });
  
          inputField.value = "";
      }
  
      loadChatMessages();  // Load previous messages on page load
  
      document.querySelector(".btm form").addEventListener("submit", sendMessage);
  //}); 


{% comment %} ======================================================================================================================== {% endcomment %}


  
  </script>
  
  
  
   
</div>

    <!-- SCRIPTS -->
    <script src={% static "js/jquery.min.js" %}></script>
    <script src={% static "js/bootstrap.bundle.min.js" %}></script>
    <script src={% static "js/isotope.pkgd.min.js" %}></script>
    <script src={% static "js/stickyfill.min.js" %}></script>
    <script src={% static "js/jquery.fancybox.min.js" %}></script>
    <script src={% static "js/jquery.easing.1.3.js" %}></script>
    
    <script src={% static "js/jquery.waypoints.min.js" %}></script>
    <script src={% static "js/jquery.animateNumber.min.js" %}></script>
    <script src={% static "js/owl.carousel.min.js" %}></script>
    
    <script src={% static "js/bootstrap-select.min.js" %}></script>
    
    <script src={% static "js/custom.js" %}></script>

     
  </body>
</html>
